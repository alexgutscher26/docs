---
title: 'Authentication Configuration'
description: 'Configure authentication for your StackForge application using Clerk'
---

# Authentication Configuration

StackForge uses Clerk for authentication, providing a complete user management system with pre-built UI components and secure authentication flows. This guide will walk you through configuring authentication for your application.

## Clerk Setup

Before configuring authentication, you'll need to set up a Clerk account and create an application.

### 1. Create a Clerk Account

1. Go to [Clerk.dev](https://clerk.dev) and sign up for an account
2. Create a new application in your Clerk dashboard
3. Note your API keys from the Clerk dashboard

### 2. Configure Environment Variables

Add the following environment variables to your `.env.local` file:

```env
# Clerk Authentication
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_XXXXXXXXXXXXXXXXXXXXXXXX
CLERK_SECRET_KEY=sk_test_XXXXXXXXXXXXXXXXXXXXXXXX
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/auth/signin
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/auth/signup
NEXT_PUBLIC_CLERK_SIGN_IN_FALLBACK_URL=/
NEXT_PUBLIC_CLERK_SIGN_UP_FALLBACK_URL=/
```

Replace the placeholder values with your actual Clerk API keys and URLs.

## Authentication Pages

StackForge includes pre-built authentication pages that you can customize:

### Sign In Page

Located at `/auth/signin`, this page provides a complete sign-in form with:

- Email/password authentication
- Social login options (Google, GitHub, etc.)
- Password reset functionality
- Redirect handling

### Sign Up Page

Located at `/auth/signup`, this page provides a complete sign-up form with:

- User registration with email/password
- Social signup options
- Email verification workflow
- Redirect handling

### Callback Page

Located at `/auth/callback`, this page handles authentication callbacks from Clerk.

## Customizing Authentication

You can customize the authentication experience by modifying the authentication components:

### Customizing the Sign In Form

To customize the sign-in form, modify the component at `src/components/auth/signin-form.tsx`:

```tsx
// Example customization
import { SignInForm } from '@/components/auth/signin-form';

export default function CustomSignInPage() {
  return (
    <div className="flex min-h-screen items-center justify-center">
      <SignInForm 
        appearance={{
          elements: {
            formButtonPrimary: 'bg-blue-500 hover:bg-blue-600 text-white',
            socialButtonsBlockButton: 'border-gray-200 hover:bg-gray-50',
          }
        }}
        signUpURL="/auth/signup"
      />
    </div>
  );
}
```

### Customizing the Sign Up Form

To customize the sign-up form, modify the component at `src/components/auth/signup-form.tsx`:

```tsx
// Example customization
import { SignUpForm } from '@/components/auth/signup-form';

export default function CustomSignUpPage() {
  return (
    <div className="flex min-h-screen items-center justify-center">
      <SignUpForm 
        appearance={{
          elements: {
            formButtonPrimary: 'bg-green-500 hover:bg-green-600 text-white',
            socialButtonsBlockButton: 'border-gray-200 hover:bg-gray-50',
          }
        }}
        signInURL="/auth/signin"
      />
    </div>
  );
}
```

## Authentication Middleware

StackForge includes authentication middleware that protects routes and handles redirects. The middleware is configured in `src/middleware.ts`:

```ts
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server';
import { NextResponse } from 'next/server';

const isProtectedRoute = createRouteMatcher(['/dashboard(.*)']);
const isPublicRoute = createRouteMatcher(['/', '/marketing(.*)']);
const isAuthRoute = createRouteMatcher(['/auth(.*)']);

export default clerkMiddleware((auth, req) => {
  const { userId } = auth();

  // Allow public routes
  if (isPublicRoute(req)) {
    return NextResponse.next();
  }

  // Redirect unauthenticated users to sign in
  if (!userId && isProtectedRoute(req)) {
    return NextResponse.redirect(new URL('/auth/signin', req.url));
  }

  // Check for authenticated users trying to access auth routes
  if (userId && isAuthRoute(req)) {
    return NextResponse.redirect(new URL('/dashboard', req.url));
  }

  // Continue with the next middleware or request handler
  return NextResponse.next();
});

export const config = {
  matcher: ['/((?!.*\\..*|_next).*)', '/(api|trpc)(.*)'],
};
```

## Protecting Routes

To protect routes in your application, you can use the `createRouteMatcher` function to define which routes require authentication:

```ts
// Example: Protecting admin routes
const isAdminRoute = createRouteMatcher(['/admin(.*)']);

export default clerkMiddleware((auth, req) => {
  const { userId, session } = auth();
  
  // Protect admin routes
  if (isAdminRoute(req)) {
    // Check if user has admin role
    const isAdmin = session?.user?.publicMetadata?.role === 'admin';
    if (!isAdmin) {
      return NextResponse.redirect(new URL('/unauthorized', req.url));
    }
  }
  
  // ... rest of middleware logic
});
```

## Session Management

Clerk provides session management out of the box. You can access the current user's session information using the `useAuth` hook:

```tsx
'use client';
import { useAuth } from '@clerk/nextjs';

export default function UserProfile() {
  const { userId, sessionId, orgId } = useAuth();
  
  if (!userId) {
    return <div>Please sign in</div>;
  }
  
  return (
    <div>
      <p>User ID: {userId}</p>
      <p>Session ID: {sessionId}</p>
      {orgId && <p>Organization ID: {orgId}</p>}
    </div>
  );
}
```

## Social Authentication

Clerk supports social authentication providers out of the box. To enable social authentication:

1. Go to your Clerk dashboard
2. Navigate to "User & Authentication" â†’ "Social Connections"
3. Enable the social providers you want to support
4. Configure the OAuth credentials for each provider

Supported providers include:
- Google
- GitHub
- Facebook
- Twitter
- LinkedIn
- GitHub
- GitLab
- Bitbucket

## Multi-Tenant Authentication

StackForge supports multi-tenant authentication through Clerk Organizations:

```tsx
'use client';
import { useOrganization, useOrganizationList } from '@clerk/nextjs';

export default function OrganizationSwitcher() {
  const { organization } = useOrganization();
  const { userMemberships } = useOrganizationList({
    infinite: true,
  });
  
  return (
    <div>
      {organization && <p>Current organization: {organization.name}</p>}
      {userMemberships?.data?.map((membership) => (
        <button key={membership.organization.id}>
          {membership.organization.name}
        </button>
      ))}
    </div>
  );
}
```

## Testing Authentication

To test authentication in your development environment:

1. Start your development server: `bun run dev`
2. Navigate to `/auth/signin` or `/auth/signup`
3. Use test credentials or social login
4. Verify that you can access protected routes like `/dashboard`

## Troubleshooting

### Common Issues

1. **Clerk Environment Variables Not Set**: Ensure all Clerk environment variables are properly configured
2. **Redirect Loops**: Check your middleware configuration for conflicting routes
3. **Social Login Not Working**: Verify OAuth credentials in your Clerk dashboard
4. **Session Issues**: Clear browser cookies and try signing in again

### Debugging Authentication

To debug authentication issues:

1. Check the browser console for errors
2. Verify environment variables are loaded correctly
3. Check the Clerk dashboard for any configuration issues
4. Review the middleware logs for redirect issues

## Next Steps

<CardGroup cols={2}>

<Card
  title="Application Configuration"
  icon="settings"
  href="/application-configuration"
>
  Configure your application environment variables
</Card>

<Card
  title="Environment Variables"
  icon="database"
  href="/environment-variables"
>
  Detailed information about all environment variables
</Card>

</CardGroup>